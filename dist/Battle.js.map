{"version":3,"sources":["../dist-esnext/Battle.js"],"names":["startBattle","fieldConfig","field","isOver","marks","bombsMarked","winner","openNearPositions","battle","pos","last","map","p","clickPosition","openAllField","col","winBattle","endBattle","loseBattle","win","position","autoOpen","message","x","y","marked","opened","isBomb","openedPos","nearBombs","checkOpenedPositions","numBombs","totalPos","length","checkMarkedPositions","correctMarked","incorrectMarked","battleMarkPosition"],"mappings":"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","file":"Battle.js","sourcesContent":["import R from 'ramda';\r\nimport { getInitialField, markPosition, nearPositions, openPosition, positionIsValid } from './Field';\r\nconst startBattle = (fieldConfig) => {\r\n    const field = getInitialField(fieldConfig);\r\n    return { field, isOver: false, marks: 0, bombsMarked: 0, winner: null };\r\n};\r\nconst openNearPositions = (battle, pos) => R.last(nearPositions(pos).map(p => clickPosition(battle, p, true)));\r\nconst openAllField = (field) => field.map(col => col.map(pos => openPosition(pos)));\r\nconst winBattle = (battle) => endBattle(battle, true);\r\nconst loseBattle = (battle) => endBattle(battle, false);\r\nfunction endBattle(battle, win) {\r\n    battle.isOver = true;\r\n    battle.winner = win;\r\n    battle.field = openAllField(battle.field);\r\n    return battle;\r\n}\r\nconst clickPosition = (battle, position, autoOpen) => {\r\n    battle.message = null;\r\n    if (!positionIsValid(battle.field, position))\r\n        return battle;\r\n    const pos = battle.field[position.x][position.y];\r\n    if (pos.marked !== 0)\r\n        return battle;\r\n    if (pos.opened) {\r\n        if (!autoOpen)\r\n            battle.message = 'Position Already open, try again';\r\n        return battle;\r\n    }\r\n    if (pos.isBomb)\r\n        return loseBattle(battle);\r\n    const openedPos = openPosition(pos);\r\n    if (openedPos.nearBombs === 0)\r\n        return openNearPositions(battle, openedPos);\r\n    return checkOpenedPositions(battle);\r\n};\r\nconst checkOpenedPositions = (battle) => {\r\n    let openedPos = 0;\r\n    let numBombs = 0;\r\n    const totalPos = battle.field.length * battle.field[0].length;\r\n    battle.field.map(col => col.map(pos => {\r\n        if (pos.opened)\r\n            openedPos++;\r\n        if (pos.isBomb)\r\n            numBombs++;\r\n    }));\r\n    if (openedPos === totalPos - numBombs) {\r\n        return winBattle(battle);\r\n    }\r\n    return battle;\r\n};\r\nconst checkMarkedPositions = (battle) => {\r\n    let correctMarked = 0, incorrectMarked = 0, numBombs = 0;\r\n    battle.field.map(col => col.map(pos => {\r\n        if (pos.isBomb)\r\n            numBombs++;\r\n        if (pos.marked && pos.isBomb)\r\n            correctMarked++;\r\n        if (pos.marked && !pos.isBomb)\r\n            incorrectMarked++;\r\n    }));\r\n    if (correctMarked === numBombs && incorrectMarked === 0) {\r\n        return winBattle(battle);\r\n    }\r\n    return battle;\r\n};\r\nconst battleMarkPosition = (battle, position) => {\r\n    if (!positionIsValid(battle.field, position))\r\n        return battle;\r\n    const pos = battle.field[position.x][position.y];\r\n    if (pos.opened)\r\n        return battle;\r\n    // if (pos.isBomb) {\r\n    //     return endBattle(battle);\r\n    // }\r\n    battle.field[position.x][position.y] = markPosition(pos);\r\n    return checkMarkedPositions(battle);\r\n};\r\nexport { startBattle, clickPosition, battleMarkPosition };\r\n//# sourceMappingURL=Battle.js.map"]}